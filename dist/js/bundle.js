var DomOutline=function(options){"use strict";options=options||{};var pub={},self={opts:{namespace:options.namespace||"DomOutline",onClick:options.onClick||false,realtime:options.realtime||false,$elem:options.elem||jQuery("body")},keyCodes:{BACKSPACE:8,ESC:27,DELETE:46},active:false,initialized:false,elements:{}};function writeStylesheet(css){var element=document.createElement("style");element.type="text/css";if(self.opts.$elem){self.opts.$elem.append(element)}else{document.getElementsByTagName("head")[0].appendChild(element)}if(element.styleSheet){element.styleSheet.cssText=css}else{element.innerHTML=css}}function initStylesheet(){var css="";if(self.initialized!==true){css+="."+self.opts.namespace+" {"+"    background: rgba(0, 153, 204, 0.05);"+"    position: fixed;"+"    z-index: 1000000;"+"    pointer-events: none;"+"    outline: 3px solid rgb(0, 153, 204);"+"}"+"."+self.opts.namespace+"_label {"+"    background: #09c;"+"    boroutlineder-radius: 2px;"+"    color: #fff;"+"    font: bold 12px/12px Helvetica, sans-serif;"+"    padding: 4px 6px;"+"    position: fixed;"+"    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.25);"+"    z-index: 1000001;"+"    pointer-events: none;"+"}"+"."+self.opts.namespace+"_box {"+"    background: rgba(0, 153, 204, 0.05);"+"    position: absolute;"+"    z-index: 1000000;"+"    pointer-events: none;"+"    outline: 3px solid rgb(0, 153, 204);"+"    box-shadow: 6px 6px 2px rgba(0, 0, 0, 0.2);"+"}";writeStylesheet(css);self.initialized=true}}function createOutlineElements(){self.elements.top=jQuery("<div>").addClass(self.opts.namespace).insertAfter(self.opts.$elem);self.elements.bottom=jQuery("<div>").addClass(self.opts.namespace).insertAfter(self.opts.$elem);self.elements.left=jQuery("<div>").addClass(self.opts.namespace).insertAfter(self.opts.$elem);self.elements.right=jQuery("<div>").addClass(self.opts.namespace).insertAfter(self.opts.$elem);self.elements.box=jQuery("<div>").addClass(self.opts.namespace+"_box").insertAfter(self.opts.$elem)}function removeOutlineElements(){jQuery.each(self.elements,function(name,element){element.remove()})}function getScrollTop(){if(!self.elements.window){self.elements.window=jQuery(window)}return self.elements.window.scrollTop()}function stopOnEscape(e){if(e.keyCode===self.keyCodes.ESC||e.keyCode===self.keyCodes.BACKSPACE||e.keyCode===self.keyCodes.DELETE){pub.stop()}return false}function draw(e){if(e.target.className.indexOf(self.opts.namespace)!==-1){return}pub.element=e.target;var scroll_top=getScrollTop(),pos=pub.element.getBoundingClientRect(),top=pos.top+scroll_top,label_text="",label_top=0,label_left=0;self.elements.box.css({top:self.opts.$elem.scrollTop()+pos.top-1,left:pos.left-1,width:pos.width+2,height:pos.height+2})}function clickHandler(e){if(!self.opts.realtime){draw(e)}self.opts.onClick(pub.element);return false}pub.start=function(){removeOutlineElements();initStylesheet();if(self.active!==true){self.active=true;createOutlineElements();self.opts.$elem.bind("keyup."+self.opts.namespace,stopOnEscape);if(self.opts.onClick){setTimeout(function(){self.opts.$elem.bind("click."+self.opts.namespace,clickHandler)},50)}if(self.opts.realtime){self.opts.$elem.bind("mousemove."+self.opts.namespace,draw)}}};pub.stop=function(){self.active=false;removeOutlineElements();self.opts.$elem.unbind("mousemove."+self.opts.namespace).unbind("keyup."+self.opts.namespace).unbind("click."+self.opts.namespace)};pub.pause=function(){self.active=false;self.opts.$elem.unbind("mousemove."+self.opts.namespace).unbind("keyup."+self.opts.namespace).unbind("click."+self.opts.namespace)};return pub};(function(window,document,$){"use strict";var FloatingMenu=function FloatingMenu(params){this.init(params)};FloatingMenu.prototype.init=function(params){this.$menu=$('<ul id="floating-settings" class="dropdown-menu" role="menu">');$("body").append(this.$menu);this.bindEvents()};FloatingMenu.prototype.create=function(params){var value=params.value||"(element)",posTop=params.posTop||0,posLeft=params.posLeft||0,menuHtml=this.newItem({value:value,is_header:true}),editList=[{value:"Edit HTML",attrs:{"data-operation":"edit-html","data-toggle":"modal","data-target":"#edit-html-modal"}},{value:"Edit Text",attrs:{"data-operation":"edit-text","data-toggle":"modal","data-target":"#edit-text-modal"}},{value:"Edit Classes",attrs:{"data-operation":"edit-classes","data-toggle":"modal","data-target":"#edit-classes-modal"}},{value:"Edit Style",attrs:{"data-operation":"edit-style"}}];menuHtml+=this.newItem({value:"Edit Element",items:editList});menuHtml+=this.newItem({attrs:{"class":"divider"}});menuHtml+=this.newItem({value:"Move and Resize",attrs:{"data-operation":"move-and-resize"}});menuHtml+=this.newItem({value:"Remove",attrs:{"data-operation":"remove"}});menuHtml+=this.newItem({attrs:{"class":"divider"}});menuHtml+=this.newItem({value:"Select Container",items:params.container});this.$menu.append(menuHtml);this.$menu.css({top:posTop-10,left:posLeft+10})};FloatingMenu.prototype.bindEvents=function(){this.$menu.on("click","li",function(e){var $el=$(e.toElement).parent(),op=$el.data("operation");if(op){var _event=new CustomEvent("floatingMenuItemClicked",{detail:{operation:op}});document.dispatchEvent(_event);console.log("Operation: "+op)}})};FloatingMenu.prototype.open=function(){this.$menu.show()};FloatingMenu.prototype.close=function(){this.$menu.hide();this.$menu.empty()};FloatingMenu.prototype.newItem=function(params){var $li=$("<li>");if(params.attrs){$li.attr(params.attrs)}if(params.is_header){$li.addClass("dropdown-header").text("<"+params.value+">")}else if(params.value){$li.append('<a tabindex="-1" href="#">'+params.value+"</a>")}if(params.items){var $subMenu=$('<ul class="dropdown-menu">');for(var i=0;i<=params.items.length-1;i++){var $_li=$('<li class="container-item-el">');$_li.attr(params.items[i].attrs).append('<a tabindex="-1" href="#">'+params.items[i].value+"</a>");$subMenu.append($_li)}$li.addClass("dropdown-submenu");$li.append($subMenu)}return $li.prop("outerHTML")};window.FloatingMenu=FloatingMenu})(window,document,$);(function(window,document,$){"use strict";var LiveEditor=function LiveEditor(params){console.log("Live Editor Init...");this.init(params);console.log("Live Editor Done...")};LiveEditor.prototype.init=function(params){var self=this;this.initVars(params);this.$editor.on("load",function(){self.domOutlineInit();self.floatingMenuInit();self.bindEvents()})};LiveEditor.prototype.initVars=function(params){this.$editor=$(params.editor).find("iframe");this.$codePainel=$("#code-painel").find("textarea");this.$editHtmlModal=$("#edit-html-modal");this.$editTextModal=$("#edit-text-modal");this.$editClassesModal=$("#edit-classes-modal");this.domOutline=null;this.scriptList=[]};LiveEditor.prototype.domOutlineInit=function(){this.domOutline=DomOutline({realtime:true,onClick:this.sendEventOnClick,elem:this.$editor.contents().find("html body")});this.domOutline.start()};LiveEditor.prototype.floatingMenuInit=function(){window.floatingMenu=new FloatingMenu};LiveEditor.prototype.modalEvents=function(){var self=this;this.$editHtmlModal.on("show.bs.modal",function(){var current_without_cache=self.$editor.contents().find(self.currentSelected)[0],html=current_without_cache.outerHTML;$(this).find(".modal-body textarea").val(html)});$("#edit-html-modal-save").on("click",function(){self.operationInit("edit-html-save");self.$editHtmlModal.modal("hide")});this.$editTextModal.on("show.bs.modal",function(){var current_without_cache=self.$editor.contents().find(self.currentSelected)[0],text=current_without_cache.textContent;$(this).find(".modal-body textarea").val(text)});$("#edit-text-modal-save").on("click",function(){self.operationInit("edit-text-save");self.$editTextModal.modal("hide")});this.$editClassesModal.on("show.bs.modal",function(){var current_without_cache=self.$editor.contents().find(self.currentSelected),classes=current_without_cache.attr("class");$(this).find(".modal-body input").val(classes)});$("#edit-classes-modal-save").on("click",function(){self.operationInit("edit-classes-save");self.$editClassesModal.modal("hide")})};LiveEditor.prototype.bindEvents=function(){var self=this;this.modalEvents();document.addEventListener("domOutlineOnClick",function(e){self.setCurrentElement(self.domOutline.element);self.openCurrentSettings();self.domOutline.pause()},false);document.addEventListener("floatingMenuItemClicked",function(e){self.operationInit(e.detail.operation)},false);this.$editor.contents().find("html").on("click",function(e){if(e.toElement!=liveEditor.$currentSelected[0]){floatingMenu.close();self.domOutline.start()}})};LiveEditor.prototype.sendEventOnClick=function(){var _event=new Event("domOutlineOnClick");document.dispatchEvent(_event)};LiveEditor.prototype.setCurrentElement=function(elem){this.currentSelected=this.getElementPath(elem);this.$currentSelected=this.$editor.contents().find(this.currentSelected);console.log("Current: "+this.currentSelected)};LiveEditor.prototype.getElementPath=function(elem){if(elem.length!=1)elem=$(elem);var path,node=elem;while(node.length){var realNode=node[0],name=realNode.localName;if(!name)break;name=name.toLowerCase();var parent=node.parent();var siblings=parent.children(name);if(siblings.length>1){name+=":eq("+siblings.index(realNode)+")"}path=name+(path?">"+path:"");node=parent}return path};LiveEditor.prototype.getCurrentParentPath=function(){var a=this.$currentSelected[0];var els=[];while(a){els.unshift(a);a=a.parentNode}return els};LiveEditor.prototype.openCurrentSettings=function(){if(this.currentSelected){var $DomOutlineBox=this.$editor.contents().find(".DomOutline_box"),top=this.$editor.offset().top,left=this.$editor.offset().left,scrollTop=this.$editor.contents().scrollTop();floatingMenu.create({value:this.$currentSelected.prop("tagName").toLowerCase(),posLeft:left+$DomOutlineBox.offset().left+$DomOutlineBox.width(),posTop:top+$DomOutlineBox.offset().top-scrollTop,container:this.containerFormat()});floatingMenu.open()}else{console.log("No item has been selected...")}};LiveEditor.prototype.containerFormat=function(){var pathList=this.getCurrentParentPath(),_list=[];for(var i=0;i<=pathList.length-1;i++){if(pathList[i].tagName){_list.push({value:pathList[i].tagName.toLowerCase(),attrs:{value:this.getElementPath(pathList[i])}})}}return _list};LiveEditor.prototype.operationInit=function(operation){if(operation==="remove"){this.currentSelectedRemove();floatingMenu.close();this.domOutline.start()}if(operation==="edit-html-save"){this.currentSelectedEditHtml()}if(operation==="edit-text-save"){this.currentSelectedEditText()}if(operation==="edit-classes-save"){this.currentSelectedEditClasses()}this.codePainelUpdate()};LiveEditor.prototype.currentSelectedRemove=function(){var str='$("'+this.currentSelected+'").remove();';this.addToScript(str);this.$editor.contents().find(this.currentSelected).remove()};LiveEditor.prototype.currentSelectedEditHtml=function(){var html=this.$editHtmlModal.find(".modal-body textarea").val(),str='$("'+this.currentSelected+'").replaceWith("'+html+'");';this.addToScript(str);this.$editor.contents().find(this.currentSelected).replaceWith(html)};LiveEditor.prototype.currentSelectedEditText=function(){var text=this.$editTextModal.find(".modal-body textarea").val(),str='$("'+this.currentSelected+'").val("'+text+'");';this.addToScript(str);this.$editor.contents().find(this.currentSelected).text(text)};LiveEditor.prototype.currentSelectedEditClasses=function(){var classes=this.$editClassesModal.find(".modal-body input").val(),str='$("'+this.currentSelected+'").attr("class", "'+classes+'");';this.addToScript(str);this.$editor.contents().find(this.currentSelected).attr("class",classes)};LiveEditor.prototype.addToScript=function(str){this.scriptList.push(str)};LiveEditor.prototype.codePainelUpdate=function(){this.$codePainel.val(this.scriptList)};window.LiveEditor=LiveEditor})(window,document,$);